# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".

name: git-tags
run-name: Update git version aliases
on:
  push:
    tags:
      - v[0-9]+.[0-9]+.[0-9]+
jobs:
  tag:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: git checkout
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11
        with:
          fetch-depth: 0
      - id: get_aliases
        uses: pr-mpt/actions-semver-aliases@01b2241f545f14efe72edaa2fcec49705dbe910d
        with:
          version: ${{ github.ref_name }}
      - name: Delete tags if they are already in use
        env:
          ALIAS_ARR: ${{ steps.get_aliases.outputs.csv }}
        run: for t in ${ALIAS_ARR//,/ }; do git push origin :refs/tags/"$t" && git tag -d "$t"; done
        continue-on-error: true
      - name: Pause to allow the remote deletion to be fully processed
        run: sleep 10s
      - name: Create the new tags
        env:
          ALIAS_ARR: ${{ steps.get_aliases.outputs.csv }}
        run: for t in ${ALIAS_ARR//,/ }; do git tag "$t" ${{ github.sha }}; done
      - name: Push tags
        run: git push origin --tags
